(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{408:function(s,t,a){"use strict";a.r(t);var n=a(45),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"å‰è¨€"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å‰è¨€"}},[s._v("#")]),s._v(" å‰è¨€")]),s._v(" "),a("p",[s._v("ä¸Šä¸€ç¯‡æ–‡ç«  "),a("a",{attrs:{href:"https://mp.weixin.qq.com/s/QIkYOcgCMzz_OPQH9L_Vfw",target:"_blank",rel:"noopener noreferrer"}},[s._v("ã€Šé€šè¿‡ JDK åŸå­å¹¶å‘ç±» AtomicInteger å½»åº•æŒæ¡ CAS æ— é”ç®—æ³•ã€‹"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("å’Œå¤§å®¶èŠäº†èŠ Atomic ç›¸å…³çš„æ¦‚å¿µ, ä¹Ÿè¯´äº†ä¸‹ AtomicInteger çš„å®ç°åŸç†")]),s._v(" "),a("p",[s._v("åŒæ—¶ä¹Ÿè¯´äº† Atomic çš„ä¸è¶³:")]),s._v(" "),a("p",[s._v("1ã€å¤šçº¿ç¨‹é«˜å¹¶å‘å¯¹å…±äº«èµ„æºè¯»å†™æ“ä½œä¼šå¯¼è‡´è‡ªæ—‹è¿‡åº¦")]),s._v(" "),a("p",[s._v("2ã€"),a("strong",[s._v('"ABA" é—®é¢˜')])]),s._v(" "),a("p",[s._v('ä»Šå¤©è¿™ç¯‡æ–‡ç« å°±æ¥èŠä¸€èŠå¦‚ä½•è§£å†³ "ABA" é—®é¢˜')]),s._v(" "),a("h2",{attrs:{id:"aba-é—®é¢˜èƒŒæ™¯"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#aba-é—®é¢˜èƒŒæ™¯"}},[s._v("#")]),s._v(" ABA é—®é¢˜èƒŒæ™¯")]),s._v(" "),a("p",[s._v("AtomicInteger å­˜åœ¨çš„ä¸€ä¸ªé—®é¢˜, ä¹Ÿæ˜¯å¤§éƒ¨åˆ† Atomic ç›¸å…³ç±»å­˜åœ¨çš„, å°±æ˜¯ ABA é—®é¢˜")]),s._v(" "),a("p",[s._v("ç®€çŸ­æ¥è¯´, å°±æ˜¯çº¿ç¨‹ä¸€è·å–åˆ° AtomicInteger çš„ value ä¸º 0, åœ¨å‡†å¤‡åšä¿®æ”¹ä¹‹å‰")]),s._v(" "),a("p",[s._v("çº¿ç¨‹äºŒå¯¹ AtomicInteger çš„ value åšäº†ä¸¤æ¬¡æ“ä½œ, ä¸€æ¬¡æ˜¯å°†å€¼ä¿®æ”¹ä¸º 1, ç„¶ååˆå°†å€¼ä¿®æ”¹ä¸ºåŸæ¥çš„ 0")]),s._v(" "),a("p",[s._v("æ­¤æ—¶çº¿ç¨‹ä¸€è¿›è¡Œ CAS æ“ä½œ, å‘ç°å†…å­˜ä¸­çš„å€¼ä¾æ—§æ˜¯ 0, OK, æ›´æ–°æˆåŠŸ, ç»“åˆä¸‹å›¾äº†è§£")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://images-machen.oss-cn-beijing.aliyuncs.com/image-20201001170629285.png",alt:""}})]),s._v(" "),a("p",[a("strong",[s._v("1ã€ä¸ºä»€ä¹ˆçº¿ç¨‹äºŒèƒ½å¤Ÿåœ¨çº¿ç¨‹ä¸€è·å–æœ€æ–°å€¼åè¿›è¡Œæ“ä½œ?")])]),s._v(" "),a("p",[s._v("æˆ‘ä»¬ä»¥ "),a("strong",[s._v("AtomicInteger#getAndIncrement")]),s._v(" è¯´æ˜")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getAndAddInt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" var1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" var2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" var4"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" var5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      \t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ ‡è®°1")]),s._v("\n        var5 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getIntVolatile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("var1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" var2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSwapInt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("var1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" var2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" var5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" var5 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" var4"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" var5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("å› ä¸ºæˆ‘ä»¬çš„ CPU æ‰§è¡Œæ˜¯ "),a("strong",[s._v("æŠ¢å å¼çš„, æ—¶é—´ç‰‡åˆ†é…å¹¶ä¸å›ºå®š")])]),s._v(" "),a("p",[s._v("å¯èƒ½åœ¨çº¿ç¨‹ä¸€è¯»å–å®Œæ ‡è®°1å¤„ä¹‹å, æ—¶é—´ç‰‡å°±åˆ†é…æ‰§è¡Œäº†çº¿ç¨‹äºŒ, æ­¤æ—¶çº¿ç¨‹ä¸€ç­‰å¾…æ—¶é—´ç‰‡çš„åˆ†é…")]),s._v(" "),a("p",[s._v("ç­‰çº¿ç¨‹äºŒåšå®Œä¸¤æ­¥æ“ä½œä¹‹å, æ—¶é—´ç‰‡åˆ†é…åˆ°çº¿ç¨‹ä¸€, è¿™æ—¶æ‰ä¼šç»§ç»­æ‰§è¡Œ")]),s._v(" "),a("p",[a("strong",[s._v("2ã€ABA ä¼šå¼•å‘ä»€ä¹ˆæ ·çš„é—®é¢˜?")])]),s._v(" "),a("p",[s._v("å¤§å®¶åº”è¯¥éƒ½çŸ¥é“äº† ABA çš„è¡Œä¸ºæ˜¯å¦‚ä½•å‘ç”Ÿçš„, åˆ—ä¸¾ç½‘ä¸Šçš„ä¸€ä¸ªå°ä¾‹å­, å¤§è‡´æ„æ€å¦‚ä¸‹:")]),s._v(" "),a("p",[s._v("1ã€å°æ˜é“¶è¡Œå¡è´¦æˆ·ä½™é¢1ä¸‡å…ƒ, å»å–æ¬¾æœºå–é’±5åƒå…ƒ, æ­£å¸¸åº”è¯¥å‘èµ·ä¸€æ¬¡è¯·æ±‚, å› ä¸ºç½‘ç»œæˆ–æœºå™¨æ•…éšœå‘èµ·äº†ä¸¤æ¬¡è¯·æ±‚")]),s._v(" "),a("blockquote",[a("p",[s._v("å„ä½å¤§å“¥å¤§å§ä¸è¦æŠ¬æ å“ˆ,  ä¸è¦è¯´ä»€ä¹ˆåç«¯æ¥å£å¹‚ç­‰, å–æ¬¾æœºé˜²é‡å¤æäº¤ä¹‹ç±»çš„, "),a("strong",[s._v("ä¾‹å­æ˜¯ä¸ºäº†è¯´æ˜é—®é¢˜")]),s._v(", æ„Ÿè°¢ ğŸ˜„")])]),s._v(" "),a("p",[s._v("2ã€çº¿ç¨‹ä¸€ã€Œç”±å–æ¬¾æœºå‘èµ·ã€: è·å–å½“å‰é“¶è¡Œå¡ä½™é¢å€¼1ä¸‡å…ƒ, æœŸæœ›å€¼5åƒå…ƒ")]),s._v(" "),a("p",[s._v("3ã€çº¿ç¨‹äºŒã€Œç”±å–æ¬¾æœºå‘èµ·ã€: è·å–å½“å‰é“¶è¡Œå¡ä½™é¢å€¼1ä¸‡å…ƒ, æœŸæœ›å€¼5åƒå…ƒ")]),s._v(" "),a("p",[s._v("4ã€çº¿ç¨‹ä¸€æˆåŠŸäº†, é“¶è¡Œå¡å†…ä½™é¢å‰©ä½™äº”åƒ,  çº¿ç¨‹äºŒæœªåˆ†é…æ—¶é—´ç‰‡, è·å–åˆ°ä½™é¢åè¢«é˜»å¡")]),s._v(" "),a("p",[s._v("5ã€æ­¤æ—¶çº¿ç¨‹ä¸‰ã€Œæ”¯ä»˜å®è½¬å…¥é“¶è¡Œå¡ã€: è·å–å½“å‰é“¶è¡Œå¡ä½™é¢5åƒå…ƒ, æœŸæœ›å€¼1ä¸‡å…ƒ, ä¿®æ”¹æˆåŠŸ")]),s._v(" "),a("p",[s._v("6ã€çº¿ç¨‹äºŒè·å¾—æ—¶é—´ç‰‡, å‘ç°å¡å†…ä½™é¢æ˜¯1ä¸‡, æˆåŠŸå°†å¡å†…ä½™é¢å‡å°‘è‡³5åƒ")]),s._v(" "),a("p",[s._v("7ã€å¡å†…ä½™é¢åŸæœ¬åº”æ˜¯1ä¸‡-5åƒ+5åƒ=1ä¸‡, æœ€ç»ˆå› ä¸º ABA é—®é¢˜å¯¼è‡´ 1ä¸‡-5åƒ+5åƒ-5åƒ=5åƒ")]),s._v(" "),a("p",[s._v("å½“ç„¶æ­£å¼ä¸šåŠ¡ä¸­, å¯èƒ½ä¸ä¼šå­˜åœ¨æ­¤ç±»é—®é¢˜, ä¸è¿‡å¹³å¸¸è‡ªå·±ä¸šåŠ¡ä¸­ä½¿ç”¨åˆ°äº†åŸå­ç±», è¿˜æ˜¯ä¼šåŸ‹ä¸‹æ½œåœ¨éšæ‚£")]),s._v(" "),a("p",[s._v("æˆ‘ä»¬å…ˆé€šè¿‡å°ç¨‹åºä»£ç æ¥çœ‹ä¸‹, ABA é—®é¢˜æ˜¯å¦‚ä½•å¤ç°çš„")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicInteger")]),s._v(" atomicInteger "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicInteger")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        atomicInteger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        atomicInteger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" result "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" atomicInteger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("format")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"  >>> ä¿®æ”¹ atomicInteger :: %s "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n     *   >>> ä¿®æ”¹ atomicInteger :: true \n     */")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[s._v("1ã€åˆ›å»ºä¸€ä¸ªåˆå§‹å€¼ä¸º100çš„ AtomicInteger, çº¿ç¨‹ä¸€å°†100-> 101, å†ä»101->100")]),s._v(" "),a("p",[s._v("2ã€ä¼‘çœ 1000ms, é˜²æ­¢æ—¶é—´ç‰‡åˆ†é…çº¿ç¨‹äºŒæå‰æ‰§è¡Œ")]),s._v(" "),a("p",[s._v("3ã€çº¿ç¨‹äºŒä»100->101, ä¿®æ”¹æˆåŠŸ")]),s._v(" "),a("h2",{attrs:{id:"atomicstampedreference"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#atomicstampedreference"}},[s._v("#")]),s._v(" AtomicStampedReference")]),s._v(" "),a("p",[s._v("å…ˆæ¥è¯´ä¸‹è§£å†³ ABA çš„æ€è·¯å§, ä¹Ÿå°±æ˜¯ "),a("strong",[s._v("AtomicStampedReference")]),s._v(" çš„åŸç†")]),s._v(" "),a("p",[s._v("å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª "),a("strong",[s._v("Pair"),a("T",[s._v(" å¯¹è±¡")])],1),s._v(", å­˜å‚¨äº† value å€¼å’Œä¸€ä¸ªç‰ˆæœ¬å·, æ¯æ¬¡æ›´æ–°é™¤äº† value å€¼è¿˜ä¼šæ›´æ–°ç‰ˆæœ¬å·")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Pair")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  \t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å­˜å‚¨å€¼, ç›¸å½“äºä¸Šæ–‡çš„å€¼100")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" reference"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç±»ä¼¼äºç‰ˆæœ¬å·çš„æ¦‚å¿µ")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" stamp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Pair")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" reference"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" stamp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("reference "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" reference"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("stamp "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" stamp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ›å»ºä¸€ä¸ªæ–°çš„Pairå¯¹è±¡, æ¯æ¬¡å€¼å˜åŒ–æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicStampedReference"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Pair")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("of")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),s._v(" reference"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" stamp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicStampedReference"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Pair")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("reference"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" stamp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("æˆ‘ä»¬è¿˜æ˜¯å…ˆé€šè¿‡ä¸€ä¸ªå°ç¨‹åºæ¥äº†è§£ä¸‹ "),a("strong",[s._v("AtomicStampedReference")]),s._v(" è¿è¡Œæœºåˆ¶")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@SneakyThrows")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicStampedReference")]),s._v(" stampedReference "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicStampedReference")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        stampedReference"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                stampedReference"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getStamp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                stampedReference"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getStamp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        stampedReference"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                stampedReference"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getStamp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                stampedReference"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getStamp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" stamp "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" stampedReference"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getStamp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" result "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" stampedReference"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" stamp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" stamp "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("format")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"  >>> ä¿®æ”¹ stampedReference :: %s "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n \t\t\t*   >>> ä¿®æ”¹ atomicInteger :: false \n \t\t\t*/")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br")])]),a("p",[s._v("1ã€åˆ›å»º AtomicStampedReference, å¹¶è®¾ç½®åˆå§‹å€¼100, ä»¥åŠç‰ˆæœ¬å·0")]),s._v(" "),a("p",[s._v("2ã€çº¿ç¨‹ä¸€ç¡çœ 50ms, ç„¶åå¯¹valueåšå‡ºæ“ä½œ100->101, 101->100, ç‰ˆæœ¬+1")]),s._v(" "),a("blockquote",[a("p",[s._v("ä¸ºä»€ä¹ˆè¦ç¡çœ 50ms? ä¸ºäº†æ¨¡æ‹Ÿå¤šçº¿ç¨‹å¹¶å‘æŠ¢å , è®©çº¿ç¨‹äºŒå…ˆè·å–åˆ°ç‰ˆæœ¬å·")])]),s._v(" "),a("p",[s._v("3ã€çº¿ç¨‹äºŒç¡çœ 500ms, ç­‰å¾…çº¿ç¨‹ä¸€æ‰§è¡Œå®Œæ¯•, å¼€å§‹å°†100->101, ç‰ˆæœ¬å·+1")]),s._v(" "),a("p",[a("strong",[s._v("ä¸å‡ºæ„å¤–, çº¿ç¨‹äºŒä¸€å®šä¼šä¿®æ”¹å¤±è´¥")]),s._v(", è™½ç„¶å€¼ç›¸å¯¹åº”, ä½†æ˜¯é¢„æœŸçš„ç‰ˆæœ¬å·ä¸ Pair ä¸­çš„å·²ä¸ä¸€è‡´")]),s._v(" "),a("h3",{attrs:{id:"compareandset"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#compareandset"}},[s._v("#")]),s._v(" compareAndSet")]),s._v(" "),a("p",[s._v("æ¥çœ‹ä¸‹å®ƒçš„ compareAndSet(...) æ˜¯å¦‚ä½•åšçš„")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n * æ¯”è¾ƒå¹¶è®¾ç½®\n *\n * @param expectedReference é¢„æœŸå€¼\n * @param newReference      æœŸæœ›å€¼\n * @param expectedStamp     é¢„æœŸç‰ˆæœ¬å·\n * @param newStamp          æœŸæœ›ç‰ˆæœ¬å·\n * @return\t\t\t\t\t\t\t\t\tæ˜¯å¦æˆåŠŸ\n */")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),s._v(" expectedReference"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                             "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),s._v(" newReference"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                             "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" expectedStamp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                             "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" newStamp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å–å½“å‰ pair å¼•ç”¨")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicStampedReference"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Pair")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" current "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" pair"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é¢„æœŸå€¼å¯¹æ¯” pair value")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" expectedReference "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" current"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("reference "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("\n      \t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é¢„æœŸç‰ˆæœ¬å·å¯¹æ¯” pair stamp")]),s._v("\n            expectedStamp "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" current"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("stamp "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("\n      \t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æœŸæœ›å€¼å¯¹æ¯” pair value")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newReference "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" current"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("reference "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("\n              \t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æœŸæœ›ç‰ˆæœ¬å·å¯¹æ¯” pair stamp")]),s._v("\n                    newStamp "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" current"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("stamp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("\n             \t\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// casPair")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("casPair")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("current"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Pair")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("of")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newReference"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" newStamp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("p",[s._v("å¦‚æœ compareAndSet(...) ä¸º True, å¿…é¡»æ»¡è¶³ä¸Šè¿°æ¡ä»¶è¡¨è¾¾å¼ä¸­3ä¸ªæ¡ä»¶")]),s._v(" "),a("p",[s._v("1ã€é¢„æœŸå€¼ç­‰äº pair value")]),s._v(" "),a("p",[s._v("2ã€é¢„æœŸç‰ˆæœ¬å·ç­‰äº pair stamp")]),s._v(" "),a("p",[s._v("3ã€æœŸæœ›å€¼ç­‰äº pair value å¹¶ä¸”æœŸæœ›ç‰ˆæœ¬å·ç­‰äº pair stamp")]),s._v(" "),a("blockquote",[a("p",[s._v("è¿™æ˜¯ value å’Œ ç‰ˆæœ¬å·æœªå‘ç”Ÿå˜åŒ–æ—¶çš„åœºæ™¯")])]),s._v(" "),a("p",[s._v("4ã€å½“ç¬¬ä¸€ä¸ªæ¡ä»¶å’Œç¬¬äºŒä¸ªæ¡ä»¶æ»¡è¶³, ä½†æ˜¯ä¸æ»¡è¶³ç¬¬ä¸‰ä¸ªæ¡ä»¶, è¯æ˜å€¼å’Œç‰ˆæœ¬å·å‘ç”Ÿäº†å˜åŒ–, åˆ›å»º Pair  è¿›è¡Œ CAS æ¯”è¾ƒæ›¿æ¢")]),s._v(" "),a("p",[a("strong",[s._v("ä¸Šè¿°æ¡ä»¶å¿…é¡»æ»¡è¶³1ã€2ã€3æˆ–è€…æ»¡è¶³1ã€2ã€4å‡å¯è¿”å› True")])]),s._v(" "),a("p",[s._v("å°†å½“å‰ Pair åŸå­å¼•ç”¨åˆ‡æ¢ä¸ºæ–° Pair, ä¸ "),a("strong",[s._v("AtomicReference æ€è·¯ä¸€è‡´")]),s._v(", å°†å¯¹è±¡å¼•ç”¨è¿›è¡ŒåŸå­è½¬æ¢")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("casPair")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicStampedReference"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Pair")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" cmp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicStampedReference"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Pair")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" val"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" UNSAFE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSwapObject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pairOffset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" cmp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" val"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"ä½¿ç”¨-integer-value-çš„å‘"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä½¿ç”¨-integer-value-çš„å‘"}},[s._v("#")]),s._v(" ä½¿ç”¨ Integer value çš„å‘")]),s._v(" "),a("p",[s._v("å°ä¼™ä¼´åº”è¯¥éƒ½çŸ¥é“, å¦‚æœä½ å†™å‡ºä¸‹é¢çš„ä»£ç , æ˜¯ä¸ä¼šåœ¨å †å†…åˆ›å»ºå¯¹è±¡çš„")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),s._v(" i1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),s._v(" i2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("å› ä¸º JVM ä¼šåœ¨å¸¸é‡æ± å†…å­˜å‚¨ä¸¤ä¸ªå¯¹è±¡, è€Œè¶…è¿‡ -128ï½127 çš„æ•°å€¼åˆ™ä¼šåœ¨å †ä¸­åˆ›å»ºå¯¹è±¡")]),s._v(" "),a("p",[s._v("æˆ‘ä»¬ Pair å¯¹è±¡çš„ reference æ˜¯èŒƒå‹, ä¼ é€’çš„ int ç±»å‹çš„æ•°å€¼ä¼šè¢«è½¬å‹, å˜ä¸º Integer")]),s._v(" "),a("p",[s._v("ä½¿ç”¨ Integer ç±»å‹å¹¶ä¸”å€¼ä¸åœ¨ -128ï½127 èŒƒå›´å†…, ä¼šå‡ºç°æ•°æ®æ¯”å¯¹å‡ºé”™çš„æƒ…å†µ, å¤§å®¶çœ‹ä¸€ä¸‹ compareAndSet(...) å°±æ˜ç™½äº†")]),s._v(" "),a("h3",{attrs:{id:"atomicmarkablereference"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#atomicmarkablereference"}},[s._v("#")]),s._v(" AtomicMarkableReference")]),s._v(" "),a("p",[s._v("å¤§å®¶çœ‹åˆ°ä¸Šé¢çš„ç‰ˆæœ¬å·ä¸¤æ¬¡æ“ä½œå¿…é¡»ä¿æŒä¸ä¸€è‡´, å¾—è‡ªå¢æˆ–ã€è‡ªå‡æˆ–è€…åˆ«çš„æ“ä½œ, ç›¸å¯¹è€Œè¨€ä¹Ÿæ¯”è¾ƒç¹ç")]),s._v(" "),a("p",[s._v("Doug Lea å¤§å¸ˆåŒæ—¶ä¹Ÿä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªçœäº‹çš„ç±»åº“ "),a("strong",[s._v("AtomicMarkableReference")])]),s._v(" "),a("p",[s._v("API æ¥å£ä»¥åŠå®ç°æ€è·¯ä¸ä¸Šè¿°çš„åŸºæœ¬ä¸€è‡´, åªä¸è¿‡æŠŠç‰ˆæœ¬å· int ç±»å‹æ›¿æ¢ä¸ºäº† boolean ç±»å‹, å…¶å®ƒæ— åŒºåˆ«")]),s._v(" "),a("p",[s._v("ä¸è¿‡, "),a("strong",[s._v("AtomicMarkableReference å¹¶ä¸èƒ½å®Œå…¨è§£å†³ ABA é—®é¢˜, åªæ˜¯èƒ½å¤Ÿå°æ¦‚ç‡é¢„é˜²")])])])}),[],!1,null,null,null);t.default=e.exports}}]);