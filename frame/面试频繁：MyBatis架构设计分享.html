<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前言 | 龙台技术笔记</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/images/book.png">
    <link rel="manifest" href="/images/book.png">
    <link rel="apple-touch-icon" href="/images/book.png">
    <meta name="description" content="技术人写的技术笔记（工作总结）">
    <meta http-quiv="pragma" cotent="no-cache">
    <meta http-quiv="pragma" cotent="no-cache,must-revalidate">
    <meta http-quiv="expires" cotent="0">
    
    <link rel="preload" href="/assets/css/0.styles.84741abc.css" as="style"><link rel="preload" href="/assets/js/app.1b4c17a3.js" as="script"><link rel="preload" href="/assets/js/2.ad010850.js" as="script"><link rel="preload" href="/assets/js/31.321ab434.js" as="script"><link rel="prefetch" href="/assets/js/10.94d80ba6.js"><link rel="prefetch" href="/assets/js/11.2f420b54.js"><link rel="prefetch" href="/assets/js/12.780d4496.js"><link rel="prefetch" href="/assets/js/13.a5ec8293.js"><link rel="prefetch" href="/assets/js/14.22c75bd2.js"><link rel="prefetch" href="/assets/js/15.a6bc3bc3.js"><link rel="prefetch" href="/assets/js/16.40ca1c91.js"><link rel="prefetch" href="/assets/js/17.1ecdc880.js"><link rel="prefetch" href="/assets/js/18.f657f93c.js"><link rel="prefetch" href="/assets/js/19.76f9fefa.js"><link rel="prefetch" href="/assets/js/20.d7e54280.js"><link rel="prefetch" href="/assets/js/21.87a15fe3.js"><link rel="prefetch" href="/assets/js/22.35a749d4.js"><link rel="prefetch" href="/assets/js/23.dee18ee7.js"><link rel="prefetch" href="/assets/js/24.3179102b.js"><link rel="prefetch" href="/assets/js/25.f4debb1b.js"><link rel="prefetch" href="/assets/js/26.53e571d4.js"><link rel="prefetch" href="/assets/js/27.2649242b.js"><link rel="prefetch" href="/assets/js/28.bd7b7239.js"><link rel="prefetch" href="/assets/js/29.178488c4.js"><link rel="prefetch" href="/assets/js/3.f5671358.js"><link rel="prefetch" href="/assets/js/30.dba7fb10.js"><link rel="prefetch" href="/assets/js/32.12e9a817.js"><link rel="prefetch" href="/assets/js/33.1efba5ba.js"><link rel="prefetch" href="/assets/js/34.e5d5831c.js"><link rel="prefetch" href="/assets/js/35.1ae0fc93.js"><link rel="prefetch" href="/assets/js/36.4d65b835.js"><link rel="prefetch" href="/assets/js/37.6a50545e.js"><link rel="prefetch" href="/assets/js/38.d78bb435.js"><link rel="prefetch" href="/assets/js/39.706e6b6c.js"><link rel="prefetch" href="/assets/js/4.52188786.js"><link rel="prefetch" href="/assets/js/40.f2fd40f1.js"><link rel="prefetch" href="/assets/js/41.b5d516b6.js"><link rel="prefetch" href="/assets/js/42.b865b616.js"><link rel="prefetch" href="/assets/js/43.f9d76365.js"><link rel="prefetch" href="/assets/js/44.a77506c5.js"><link rel="prefetch" href="/assets/js/45.f6c0a8dd.js"><link rel="prefetch" href="/assets/js/46.0ad618af.js"><link rel="prefetch" href="/assets/js/47.0079f20d.js"><link rel="prefetch" href="/assets/js/48.64c7ca11.js"><link rel="prefetch" href="/assets/js/49.43a22984.js"><link rel="prefetch" href="/assets/js/5.59fc555e.js"><link rel="prefetch" href="/assets/js/6.256d2fbb.js"><link rel="prefetch" href="/assets/js/7.0d1e400d.js"><link rel="prefetch" href="/assets/js/8.aab2d760.js"><link rel="prefetch" href="/assets/js/9.902bae2f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.84741abc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">龙台技术笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/home/guide.html" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/db/" class="nav-link">
  数据库
</a></div><div class="nav-item"><a href="/thread/" class="nav-link">
  并发编程
</a></div><div class="nav-item"><a href="/frame/" class="nav-link router-link-active">
  框架知识
</a></div><div class="nav-item"><a href="/design/" class="nav-link">
  代码设计
</a></div><div class="nav-item"><a href="/bug/" class="nav-link">
  BUG 专栏
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其它" class="dropdown-title"><span class="title">其它</span> <span class="arrow down"></span></button> <button type="button" aria-label="其它" class="mobile-dropdown-title"><span class="title">其它</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/acmenlt" target="_blank" rel="noopener noreferrer" class="nav-link external">
  动态线程池
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://house.machen.me" target="_blank" rel="noopener noreferrer" class="nav-link external">
  买房实践
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/acmenlt" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/home/guide.html" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/db/" class="nav-link">
  数据库
</a></div><div class="nav-item"><a href="/thread/" class="nav-link">
  并发编程
</a></div><div class="nav-item"><a href="/frame/" class="nav-link router-link-active">
  框架知识
</a></div><div class="nav-item"><a href="/design/" class="nav-link">
  代码设计
</a></div><div class="nav-item"><a href="/bug/" class="nav-link">
  BUG 专栏
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其它" class="dropdown-title"><span class="title">其它</span> <span class="arrow down"></span></button> <button type="button" aria-label="其它" class="mobile-dropdown-title"><span class="title">其它</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/acmenlt" target="_blank" rel="noopener noreferrer" class="nav-link external">
  动态线程池
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://house.machen.me" target="_blank" rel="noopener noreferrer" class="nav-link external">
  买房实践
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/acmenlt" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前言</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frame/%E9%9D%A2%E8%AF%95%E9%A2%91%E7%B9%81%EF%BC%9AMyBatis%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%88%86%E4%BA%AB.html#前言" class="sidebar-link">前言</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/frame/%E9%9D%A2%E8%AF%95%E9%A2%91%E7%B9%81%EF%BC%9AMyBatis%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%88%86%E4%BA%AB.html#_1、带着问题思考本次分享" class="sidebar-link">1、带着问题思考本次分享</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/frame/%E9%9D%A2%E8%AF%95%E9%A2%91%E7%B9%81%EF%BC%9AMyBatis%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%88%86%E4%BA%AB.html#_2、持久层的那些事" class="sidebar-link">2、持久层的那些事</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frame/%E9%9D%A2%E8%AF%95%E9%A2%91%E7%B9%81%EF%BC%9AMyBatis%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%88%86%E4%BA%AB.html#_2-1-jdbc" class="sidebar-link">2.1 JDBC</a></li><li class="sidebar-sub-header"><a href="/frame/%E9%9D%A2%E8%AF%95%E9%A2%91%E7%B9%81%EF%BC%9AMyBatis%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%88%86%E4%BA%AB.html#_2-2-mybatis" class="sidebar-link">2.2 Mybatis</a></li></ul></li><li><a href="/frame/%E9%9D%A2%E8%AF%95%E9%A2%91%E7%B9%81%EF%BC%9AMyBatis%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%88%86%E4%BA%AB.html#_3、mybatis-关键词说明" class="sidebar-link">3、Mybatis 关键词说明</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frame/%E9%9D%A2%E8%AF%95%E9%A2%91%E7%B9%81%EF%BC%9AMyBatis%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%88%86%E4%BA%AB.html#sqlsession" class="sidebar-link">SqlSession</a></li><li class="sidebar-sub-header"><a href="/frame/%E9%9D%A2%E8%AF%95%E9%A2%91%E7%B9%81%EF%BC%9AMyBatis%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%88%86%E4%BA%AB.html#sqlsessionfactory" class="sidebar-link">SqlSessionFactory</a></li><li class="sidebar-sub-header"><a href="/frame/%E9%9D%A2%E8%AF%95%E9%A2%91%E7%B9%81%EF%BC%9AMyBatis%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%88%86%E4%BA%AB.html#sqlsessionfactorybuilder" class="sidebar-link">SqlSessionFactoryBuilder</a></li><li class="sidebar-sub-header"><a href="/frame/%E9%9D%A2%E8%AF%95%E9%A2%91%E7%B9%81%EF%BC%9AMyBatis%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%88%86%E4%BA%AB.html#configuration" class="sidebar-link">Configuration</a></li><li class="sidebar-sub-header"><a href="/frame/%E9%9D%A2%E8%AF%95%E9%A2%91%E7%B9%81%EF%BC%9AMyBatis%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%88%86%E4%BA%AB.html#mappedstatement" class="sidebar-link">MappedStatement</a></li><li class="sidebar-sub-header"><a href="/frame/%E9%9D%A2%E8%AF%95%E9%A2%91%E7%B9%81%EF%BC%9AMyBatis%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%88%86%E4%BA%AB.html#executor" class="sidebar-link">Executor</a></li><li class="sidebar-sub-header"><a href="/frame/%E9%9D%A2%E8%AF%95%E9%A2%91%E7%B9%81%EF%BC%9AMyBatis%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%88%86%E4%BA%AB.html#parameterhandler" class="sidebar-link">ParameterHandler</a></li><li class="sidebar-sub-header"><a href="/frame/%E9%9D%A2%E8%AF%95%E9%A2%91%E7%B9%81%EF%BC%9AMyBatis%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%88%86%E4%BA%AB.html#statementhandler" class="sidebar-link">StatementHandler</a></li><li class="sidebar-sub-header"><a href="/frame/%E9%9D%A2%E8%AF%95%E9%A2%91%E7%B9%81%EF%BC%9AMyBatis%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%88%86%E4%BA%AB.html#resultsethandler" class="sidebar-link">ResultSetHandler</a></li><li class="sidebar-sub-header"><a href="/frame/%E9%9D%A2%E8%AF%95%E9%A2%91%E7%B9%81%EF%BC%9AMyBatis%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%88%86%E4%BA%AB.html#interceptor" class="sidebar-link">Interceptor</a></li></ul></li><li><a href="/frame/%E9%9D%A2%E8%AF%95%E9%A2%91%E7%B9%81%EF%BC%9AMyBatis%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%88%86%E4%BA%AB.html#_4、mybatis-架构设计" class="sidebar-link">4、Mybatis 架构设计</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frame/%E9%9D%A2%E8%AF%95%E9%A2%91%E7%B9%81%EF%BC%9AMyBatis%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%88%86%E4%BA%AB.html#_4-1-架构图" class="sidebar-link">4.1 架构图</a></li><li class="sidebar-sub-header"><a href="/frame/%E9%9D%A2%E8%AF%95%E9%A2%91%E7%B9%81%EF%BC%9AMyBatis%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%88%86%E4%BA%AB.html#_4-2-基础支持层" class="sidebar-link">4.2 基础支持层</a></li><li class="sidebar-sub-header"><a href="/frame/%E9%9D%A2%E8%AF%95%E9%A2%91%E7%B9%81%EF%BC%9AMyBatis%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%88%86%E4%BA%AB.html#_4-3-核心处理层" class="sidebar-link">4.3 核心处理层</a></li><li class="sidebar-sub-header"><a href="/frame/%E9%9D%A2%E8%AF%95%E9%A2%91%E7%B9%81%EF%BC%9AMyBatis%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%88%86%E4%BA%AB.html#_4-4-接口层" class="sidebar-link">4.4 接口层</a></li></ul></li><li><a href="/frame/%E9%9D%A2%E8%AF%95%E9%A2%91%E7%B9%81%EF%BC%9AMyBatis%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%88%86%E4%BA%AB.html#_5、问题答疑" class="sidebar-link">5、问题答疑</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frame/%E9%9D%A2%E8%AF%95%E9%A2%91%E7%B9%81%EF%BC%9AMyBatis%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%88%86%E4%BA%AB.html#_5-1-xml-文件定义-sql-语句如何解析" class="sidebar-link">5.1 .xml 文件定义 Sql 语句如何解析</a></li><li class="sidebar-sub-header"><a href="/frame/%E9%9D%A2%E8%AF%95%E9%A2%91%E7%B9%81%EF%BC%9AMyBatis%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%88%86%E4%BA%AB.html#_5-2-mapper-接口的存储与实现" class="sidebar-link">5.2 Mapper 接口的存储与实现</a></li><li class="sidebar-sub-header"><a href="/frame/%E9%9D%A2%E8%AF%95%E9%A2%91%E7%B9%81%EF%BC%9AMyBatis%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%88%86%E4%BA%AB.html#_5-3-mybatis-sql-的执行过程" class="sidebar-link">5.3 Mybatis Sql 的执行过程</a></li><li class="sidebar-sub-header"><a href="/frame/%E9%9D%A2%E8%AF%95%E9%A2%91%E7%B9%81%EF%BC%9AMyBatis%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%88%86%E4%BA%AB.html#_5-4-mybatis-中分页如何实现" class="sidebar-link">5.4 Mybatis 中分页如何实现</a></li></ul></li><li><a href="/frame/%E9%9D%A2%E8%AF%95%E9%A2%91%E7%B9%81%EF%BC%9AMyBatis%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%88%86%E4%BA%AB.html#_6、相关链接" class="sidebar-link">6、相关链接</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>本次分享内容依据 Mybatis-3-3.4.x 源码</p> <h2 id="_1、带着问题思考本次分享"><a href="#_1、带着问题思考本次分享" class="header-anchor">#</a> 1、带着问题思考本次分享</h2> <ol><li>Mybatis 与 JDBC 的关系</li> <li>.xml 文件定义 SQL 语句如何解析</li> <li>Mybatis 中 Mapper 接口的存储与实现</li> <li>Mybatis SQL 的执行过程</li> <li>Mybatis 中分页如何实现</li></ol> <h2 id="_2、持久层的那些事"><a href="#_2、持久层的那些事" class="header-anchor">#</a> 2、持久层的那些事</h2> <h3 id="_2-1-jdbc"><a href="#_2-1-jdbc" class="header-anchor">#</a> 2.1 JDBC</h3> <h4 id="什么是-jdbc"><a href="#什么是-jdbc" class="header-anchor">#</a> 什么是 JDBC</h4> <p>JDBC（JavaDataBase Connectivity）就是 Java 数据库连接, 说的直白点就是 <strong>使用 Java 语言操作数据库</strong></p> <p>本来我们是通过控制台或客户端操作的数据库, JDBC 是用 Java 语言来发送 SQL 语句</p> <h4 id="jdbc-原理"><a href="#jdbc-原理" class="header-anchor">#</a> JDBC 原理</h4> <p>最初 SUN 公司希望提供一套 <strong>能够适用所有数据库的 API</strong>, 但是在实际操作中却发现这是项基本不可能完成的任务</p> <p>因为各个厂商所提供的 <strong>数据库差异实在太大</strong>, 所以 SUN 公司与数据库厂商讨论出的就是：由 <strong>SUN 公司提供出一套访问数据库的规范 API</strong>, 并提供相对应的连接数据库协议标准, 然后各厂商根据规范提供一套访问自家数据库的 API 接口</p> <p>最终：SUN 公司提供的规范 API 称之为 <strong>JDBC</strong>, 各厂商提供的自家数据库 API 接口称之为 <strong>驱动</strong></p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/image-20200818124614542.png" alt="JDBC 架构图"></p> <h3 id="_2-2-mybatis"><a href="#_2-2-mybatis" class="header-anchor">#</a> 2.2 Mybatis</h3> <h4 id="什么是-mybatis"><a href="#什么是-mybatis" class="header-anchor">#</a> 什么是 Mybatis</h4> <p>Mybatis 是一款优秀的 ORM（持久层）框架，使用 Java 语言 编写</p> <p>前身是 apache 的一个开源项目 iBatis，2010 年迁移到 google code 并正式改名为 Mybatis</p> <p>ORM 持久层 指的是 : <strong>将业务数据存储到磁盘，也具备长期存储能力，只要磁盘不损坏，如果在断电情况下，重启系统仍然可以读取数据</strong></p> <h4 id="mybatis-与-jdbc-的关系"><a href="#mybatis-与-jdbc-的关系" class="header-anchor">#</a> Mybatis 与 JDBC 的关系</h4> <p>在没有持久层框架之前, 想要代码中操作数据库都必须通过 JDBC 来操作, 接下来一个例子来说明两者之间的关系</p> <p><strong>JDBC 操作数据库</strong></p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/carbon_jdbc.png" alt="JDBC"></p> <p>相信大家都在实际项目中使用过 Mybatis, 可以联想一下, 平常我们工作中, 是否做过以下事情：</p> <ul><li>是否装载过数据库驱动？</li> <li>是否从驱动中获取数据库连接？</li> <li>是否创建过执行 SQL 的 Statement？</li> <li>是否自行将数据库返回结果转换成 Java 对象？</li> <li>是否关闭过 finally 块中的三个对象？</li></ul> <p>看到上面的灵魂拷问, 就可以对本次分享的第一个问题作出解答:</p> <p><strong>Mybatis 针对 JDBC 中重复操作做了封装, 同时扩展并优化部分功能</strong></p> <h2 id="_3、mybatis-关键词说明"><a href="#_3、mybatis-关键词说明" class="header-anchor">#</a> 3、Mybatis 关键词说明</h2> <blockquote><p>📖 如果在阅读文章前没有接触过 Mybatis 源码相关的内容, 建议将下述名词多看几遍再向下阅读</p></blockquote> <h3 id="sqlsession"><a href="#sqlsession" class="header-anchor">#</a> SqlSession</h3> <p>负责执行 <strong>select、insert、update、delete</strong> 等命令, 同时负责获取映射器和管理事务; 其底层封装了与 JDBC 的交互, 可以说是 mybatis 最核心的接口之一</p> <h3 id="sqlsessionfactory"><a href="#sqlsessionfactory" class="header-anchor">#</a> SqlSessionFactory</h3> <p>负责创建 <strong>SqlSession</strong> 的工厂, 一旦被创建就应该在应用运行期间一直存在, <strong>不需要额外再进行创建</strong></p> <h3 id="sqlsessionfactorybuilder"><a href="#sqlsessionfactorybuilder" class="header-anchor">#</a> SqlSessionFactoryBuilder</h3> <p>主要是负责创建 <strong>SqlSessionFactory</strong> 的构造器类, 其中使用到了构建者设计模式; 仅负责创建 <strong>SqlSessionFactory</strong></p> <h3 id="configuration"><a href="#configuration" class="header-anchor">#</a> Configuration</h3> <p>Mybatis 最重要的配置类, 没有之一, 存储了大量的对象配置, 可以看源码感受一下</p> <h3 id="mappedstatement"><a href="#mappedstatement" class="header-anchor">#</a> MappedStatement</h3> <p>MappedStatement 是保存 SQL 语句的数据结构, 其中的类属性都是由解析 .xml 文件中的 SQL 标签转化而成</p> <h3 id="executor"><a href="#executor" class="header-anchor">#</a> Executor</h3> <p>SqlSession 对象对应一个 Executor, Executor 对象作用于 <strong>增删改查方法</strong> 以及 <strong>事务、缓存</strong> 等操作</p> <h3 id="parameterhandler"><a href="#parameterhandler" class="header-anchor">#</a> ParameterHandler</h3> <p>Mybatis 中的 <strong>参数处理器</strong>, 类关系比较简单</p> <h3 id="statementhandler"><a href="#statementhandler" class="header-anchor">#</a> StatementHandler</h3> <p>StatementHandler 是 Mybatis 负责 <strong>创建 Statement 的处理器</strong>, 根据不同的业务创建不同功能的 Statement</p> <h3 id="resultsethandler"><a href="#resultsethandler" class="header-anchor">#</a> ResultSetHandler</h3> <p>ResultSetHandler 是 Mybatis 负责将 JDBC 返回数据进行解析, 并包装为 Java 中对应数据结构的处理器</p> <h3 id="interceptor"><a href="#interceptor" class="header-anchor">#</a> Interceptor</h3> <p>Interceptor 为 Mybatis 中定义公共拦截器的接口, 其中定义了相关实现方法</p> <h2 id="_4、mybatis-架构设计"><a href="#_4、mybatis-架构设计" class="header-anchor">#</a> 4、Mybatis 架构设计</h2> <h3 id="_4-1-架构图"><a href="#_4-1-架构图" class="header-anchor">#</a> 4.1 架构图</h3> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/Mybatis%E6%9E%B6%E6%9E%84%E5%88%86%E6%9E%90-Mybatis%E6%9E%B6%E6%9E%84%E5%9B%BE_2.png" alt="Mybatis 分层架构图"></p> <h3 id="_4-2-基础支持层"><a href="#_4-2-基础支持层" class="header-anchor">#</a> 4.2 基础支持层</h3> <h4 id="反射模块"><a href="#反射模块" class="header-anchor">#</a> 反射模块</h4> <p>反射在 Java 中的应用可以说是相当广泛了, 同时也是一把双刃剑。 Mybatis 框架本身 <strong>封装出了反射模块</strong>, 提供了比原生反射更 <strong>简洁易用的 API 接口</strong>, 以及对 <strong>类的元数据增加缓存, 提高反射的性能</strong></p> <h4 id="类型转换"><a href="#类型转换" class="header-anchor">#</a> 类型转换</h4> <p>类型转换模块最重要的功能就是在为 SQL 语句绑定实参时, 将 <strong>Java 类型转为 JDBC 类型</strong>, 在映射结果集时再由 <strong>JDBC 类型转为 Java 类型</strong></p> <p>另外一个功能就是提供别名机制, 简化了配置文件的定义</p> <h4 id="日志模块"><a href="#日志模块" class="header-anchor">#</a> 日志模块</h4> <p>日志对于系统的作用不言而喻, 尤其是测试、生产环境上查看信息及排查错误等都非常重要。主流的日志框架包括 Log4j、Log4j2、S l f4j 等, Mybatis 的日志模块作用就是 <strong>集成这些日志框架</strong></p> <h4 id="资源加载"><a href="#资源加载" class="header-anchor">#</a> 资源加载</h4> <p>Mybatis 对类加载器进行了封装, 用来确定类加载器的使用顺序, 用来记载类文件以及其它资源文件, 感兴趣可以参考 <strong>ClassLoaderWrapper</strong></p> <h4 id="解析器模块"><a href="#解析器模块" class="header-anchor">#</a> 解析器模块</h4> <p>解析器模块主要提供了两个功能, 一个是封装了 XPath 类, 在 Mybatis 初始化时解析 Mybatis-config.xml 配置文件以及映射配置文件提供功能, 另一点就是处理动态 SQL 语句的占位符提供帮助</p> <h4 id=""><a href="#" class="header-anchor">#</a> ...</h4> <h3 id="_4-3-核心处理层"><a href="#_4-3-核心处理层" class="header-anchor">#</a> 4.3 核心处理层</h3> <h4 id="配置解析"><a href="#配置解析" class="header-anchor">#</a> 配置解析</h4> <p>在 Mybatis 初始化时, 会加载 Mybatis-config.xml 文件中的配置信息, 解析后的配置信息会 <strong>转换成 Java 对象添加到 Configuration 对象</strong></p> <blockquote><p>📖 比如说在 .xml 中定义的 resultMap 标签, 会被解析为 ResultMap 对象</p></blockquote> <h4 id="sql-解析"><a href="#sql-解析" class="header-anchor">#</a> SQL 解析</h4> <p>大家如果手动拼写过复杂 SQL 语句, 就会明白会有多痛苦。Mybatis 提供出了动态 SQL, 加入了许多判断循环型标签, 比如 : if、where、foreach、set 等, 帮助开发者节约了大量的 SQL 拼写时间</p> <p>SQL 解析模块的作用就是将 Mybatis 提供的动态 SQL 标签解析为带占位符的 SQL 语句, 并在后期将实参对占位符进行替换</p> <h4 id="sql-执行"><a href="#sql-执行" class="header-anchor">#</a> SQL 执行</h4> <p>SQL 的执行过程涉及几个比较重要的对象, <strong>Executor、StatementHandler、ParameterHandler、ResultSetHandler</strong></p> <p>Executor 负责维护 <strong>一级、二级缓存以及事务提交回滚操作</strong>, 举个查询的例子, 查询请求会由 Executor 交给 StatementHandler 完成</p> <p>StatementHandler 通过 ParameterHandler 完成 <strong>SQL 语句的实参绑定</strong>, 通过 java.sql.Statement 执行 SQL 语句并拿到对应的 <strong>结果集映射</strong></p> <p>最后交由 ResultSetHandler 对结果集进行解析, 将 JDBC 类型转换为程序自定义的对象</p> <h4 id="插件"><a href="#插件" class="header-anchor">#</a> 插件</h4> <p>插件模块是 Mybatis 提供的一层扩展, 可以针对 SQL 执行的四大对象进行 <strong>拦截并执行自定义插件</strong></p> <p>插件编写需要很熟悉 Mybatis 运行机制, 这样才能控制编写的插件安全、高效</p> <h3 id="_4-4-接口层"><a href="#_4-4-接口层" class="header-anchor">#</a> 4.4 接口层</h3> <p>接口层只是 Mybatis <strong>提供给调用端的一个接口 SqlSession</strong>, 调用端在进行调用接口中方法时, 会调用核心处理层相对应的模块来完成数据库操作</p> <h2 id="_5、问题答疑"><a href="#_5、问题答疑" class="header-anchor">#</a> 5、问题答疑</h2> <h3 id="_5-1-xml-文件定义-sql-语句如何解析"><a href="#_5-1-xml-文件定义-sql-语句如何解析" class="header-anchor">#</a> 5.1 .xml 文件定义 Sql 语句如何解析</h3> <p>Mybatis 在创建 SqlSessionFactory 时, XMLConfigBuilder 会解析 Mybatis-config.xml 配置文件</p> <h4 id="mybatis-相关解析器"><a href="#mybatis-相关解析器" class="header-anchor">#</a> Mybatis 相关解析器</h4> <p>Mybatis 解析器模块中定义了相关解析器的抽象类 BaseBuilder, 不同的子类负责实现解析不同的功能, 使用了 Builder 设计模式</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/image-20200902131259623.png" alt="BaseBuilder"></p> <p>XMLConfigBuilder 负责解析 mybatis-config.xml 配置文件</p> <p>XMLMapperBuilder 负责解析业务产生的 xxxMapper.xml</p> <p>...</p> <h4 id="mybatis-config-xml-解析"><a href="#mybatis-config-xml-解析" class="header-anchor">#</a> mybatis-config.xml 解析</h4> <p>XMLConfigBuilder 解析 mybatis-config.xml 内容参考代码 :</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/parseConfiguration.png" alt="parseConfiguration"></p> <p><strong>XMLConfifigBuilder#parseConfiguration()</strong> 方法将 mybatis-config.xml 中定义的标签进行相关解析并填充到 Configuration 对象中</p> <h4 id="xxxmapper-xml-解析"><a href="#xxxmapper-xml-解析" class="header-anchor">#</a> xxxMapper.xml 解析</h4> <p><strong>XMLConfifigBuilder#mapperElement()</strong> 中解析配置的 mappers 标签, 找到具体的 .xml 文件, 并将其中的 select、insert、update、delete、resultMap 等标签解析为 Java 中的对象信息</p> <p>具体解析 xxxMapper.xml 的对象为 XMLMapperBuilder, 具体的解析方法为 parse()</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/parse.png" alt="parse"></p> <p>到这里就可以对当前问题作出答复了</p> <p>Mybatis 创建 <strong>SqlSessionFactory</strong> 会解析 <strong>mybatis-config.xml</strong>, 然后 <strong>解析 configuration 标签下的子标签</strong>, 解析 mappers 标签时, 会根据相关配置读取到 .xml 文件, 继而解析 .xml 中各个标签</p> <p>具体的 select、insert、update、delete 标签定义为 <strong>MappedStatement</strong> 对象, .xml 文件中的其余标签也会根据不同映射解析为 Java 对象</p> <h4 id="mappedstatement-2"><a href="#mappedstatement-2" class="header-anchor">#</a> MappedStatement</h4> <p>这里重点说明下 MappedStatement 对象, 一起看一下类中的属性和 SQL 有何关联呢</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/MappedStatement.png" alt="MappedStatement"></p> <p>MappedStatement 对象中 <strong>提供的属性与 .xml 文件中定义的 SQL 语句</strong> 是能够对应上的, 用来 <strong>控制每条 SQL 语句的执行行为</strong></p> <h3 id="_5-2-mapper-接口的存储与实现"><a href="#_5-2-mapper-接口的存储与实现" class="header-anchor">#</a> 5.2 Mapper 接口的存储与实现</h3> <p>在平常我们写的 SSM 框架中, 定义了 Mapper 接口与 .xml 对应的 SQL 文件, 在 Service 层直接注入 xxxMapper 就可以了</p> <p>也没有看到像 JDBC 操作数据库的操作, Mybatis 在中间是如何为我们省略下这些重复繁琐的操作呢</p> <p>这里使用 Mybatis 源码中的测试类进行验证, 首先定义 Mapper 接口, 省事直接注解定义 SQL</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/AutoConstructorMapper_new.png" alt="AutoConstructorMapper"></p> <p>这里使用 SqlSession 来获取 Mapper 操作数据库, 测试方法如下</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/primitiveSubjects.png" alt="primitiveSubjects"></p> <h4 id="创建-sqlsession"><a href="#创建-sqlsession" class="header-anchor">#</a> 创建 SqlSession</h4> <p>#1 从 SqlSessionFactory 中打开一个 新的 SqlSession</p> <h4 id="获取-mapper-实例"><a href="#获取-mapper-实例" class="header-anchor">#</a> 获取 Mapper 实例</h4> <p>#2 就存在一个疑问点, 定义的 AutoConstructorMapper 明明是个接口, <strong>为什么可以实例化为对象?</strong></p> <h4 id="动态代理方法调用"><a href="#动态代理方法调用" class="header-anchor">#</a> 动态代理方法调用</h4> <p>#3 通过创建的对象调用类中具体的方法, 这里具体聊一下 #2 操作</p> <p>SqlSession 是一个接口, 有一个 <strong>默认的实现类 DefaultSqlSession</strong>, 类中包含了 Configuration 属性</p> <p>Mapper 接口的信息以及 .xml 中 SQL 语句是在 Mybatis <strong>初始化时添加</strong> 到 Configuration 的 <strong>MapperRegistry</strong> 属性中的</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/addMapper.png" alt="MapperRegistry#addMapper"></p> <p>#2 中的 getMapper 就是从 MapperRegistry 中获取 Mapper</p> <p>看一下 MapperRegistry 的类属性都有什么</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/MapperRegistry.png" alt="MapperRegistry"></p> <p>config 为 <strong>保持全局唯一</strong> 的 Configuration 对象引用</p> <p><strong>knownMappers</strong> 中 Key-Class 是 Mapper 对象, Value-MapperProxyFactory 是通过 Mapper 对象衍生出的 <strong>Mapper 代理工厂</strong></p> <p>再看一下 MapperProxyFactory 类的结构信息</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/MapperProxyFactory.png" alt="MapperProxyFactory"></p> <p>mapperInterface 属性是 Mapper 对象的引用, methodCache 的 key 是 Mapper 中的方法, value 是 Mapper 解析对应 SQL 产生的 MapperMethod</p> <blockquote><p>📖 Mybatis 设计 methodCache 属性时使用到了 <strong>懒加载机制</strong>, 在初始化时不会增加对应 Method, 而是在 <strong>第一次调用时新增</strong></p></blockquote> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/cachedMapperMethod.png" alt="cachedMapperMethod"></p> <p>MapperMethod 运行时数据如下, 比较容易理解</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/image-20200902133450941.png" alt="MapperMethod 运行状态"></p> <p>通过一个实际例子帮忙理解一下 MapperRegistry 类关系, Mapper 初始化第一次调用的对象状态, 可以看到 methodCache 容量为0</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/image-20200821191913092.png" alt="MapperRegistry 运行状态"></p> <p>我们目前已经知道 MapperRegistry 的类关系, 回头继续看一下第二步的 <strong>MapperRegistry#getMapper</strong>() 处理步骤</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/getMapper.png" alt="getMapper"></p> <p>核心处理在 MapperProxyFactory#newInstance() 方法中, 继续跟进</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/newInstance.png" alt="newInstance"></p> <p>MapperProxy <strong>继承了 InvocationHandler 接口</strong>, 通过 newInstance() 最终返回的是由 <strong>Java Proxy 动态代理返回的动态代理实现类</strong></p> <p>看到这里就清楚了步骤二中接口为什么能够被实例化, 返回的是 <strong>接口的动态代理实现类</strong></p> <h3 id="_5-3-mybatis-sql-的执行过程"><a href="#_5-3-mybatis-sql-的执行过程" class="header-anchor">#</a> 5.3 Mybatis Sql 的执行过程</h3> <p>根据 Mybatis SQL 执行流程图进一步了解</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/Mybatis-SQL%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B.png" alt="Mybatis-SQL执行流程"></p> <p>大致可以分为以下几步操作:</p> <blockquote><p>📖 在前面的内容中, 知道了 Mybatis Mapper 是动态代理的实现, 查看 SQL 执行过程, 就需要紧跟实现了 InvocationHandler 的 MapperProxy 类</p></blockquote> <h4 id="执行增删改查"><a href="#执行增删改查" class="header-anchor">#</a> 执行增删改查</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">&quot; SELECT * FROM SUBJECT WHERE ID = #{id}&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">PrimitiveSubject</span> <span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token keyword">final</span> <span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>我们以上述方法举例, 调用方通过 SqlSession 获取 Mapper 动态代理对象, 执行 Mapper 方法时会通过 <strong>InvocationHandler 进行代理</strong></p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/MapperProxy.png" alt="MapperProxy"></p> <p>在 MapperMethod#execute 中, 根据 MapperMethod -&gt; SqlCommand -&gt; <strong>SqlCommandType</strong> 来确定增、删、改、查方法</p> <blockquote><p>📖 SqlCommandType 是一个枚举类型, 对应五种类型 UNKNOWN、INSERT、UPDATE、DELETE、SELECT、FLUSH</p></blockquote> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/execute.png" alt="execute"></p> <h4 id="参数处理"><a href="#参数处理" class="header-anchor">#</a> 参数处理</h4> <p>查询操作对应 SELECT 枚举值, if else 中判断为返回值是否集合、无返回值、单条查询等, 这里以查询单条记录作为入口</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Object</span> param <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">convertArgsToSqlCommandParam</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
result <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/convertArgsToSqlCommandParam_new.png" alt="convertArgsToSqlCommandParam_new"></p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/image-20200902124629730.png" alt="参数解析"></p> <blockquote><p>📖 这里能够解释一个之前困扰我的问题, 那就是为什么方法入参只有单个 <code>@Param(&quot;id&quot;)</code>, 但是参数 param 对象会存在两个键值对</p></blockquote> <p>继续查看 <strong>SqlSession#selectOne</strong> 方法, sqlSession 是一个接口, 具体还是要看实现类 <strong>DefaultSqlSession</strong></p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/selectOne.png" alt="selectOne"></p> <p>因为单条和查询多条以及分页查询都是走的一个方法, 所以在查询的过程中, 会将分页的参数进行添加</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/selectList_new.png" alt="selectList"></p> <h4 id="执行器处理"><a href="#执行器处理" class="header-anchor">#</a> 执行器处理</h4> <p>在 Mybatis 源码中, 创建的执行器默认是 <strong>CachingExecutor,</strong> 使用了装饰者模式, 在类中保持了 <strong>Executor</strong> 接口的引用, <strong>CachingExecutor</strong> 在持有的执行器基础上增加了缓存的功能</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/CachingExecutor-query-new.png" alt="CachingExecutor#query"></p> <p><strong>delegate.<E>query</E></strong> 就是在具体的执行器了, 默认 <strong>SimpleExecutor,</strong> query 方法统一在抽象父类 <strong>BaseExecutor</strong> 中维护</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/BaseExecutor_query.png" alt="BaseExecutor#query"></p> <p><strong>BaseExecutor#queryFromDatabase</strong> 方法执行了缓存占位符以及执行具体方法, 并将查询返回数据添加至缓存</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/queryFromDatabase.png" alt="queryFromDatabase"></p> <p><strong>BaseExecutor#doQuery</strong> 方法是由具体的 SimpleExecutor 实现</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/doQuery.png" alt="doQuery"></p> <h4 id="执行-sql"><a href="#执行-sql" class="header-anchor">#</a> 执行 SQL</h4> <p>因为我们 SQL 中使用了参数占位符, 使用的是 <strong>PreparedStatementHandler</strong> 对象, 执行预编译SQL的 Handler, 实际使用 <strong>PreparedStatement</strong> 进行 SQL 调用</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/PreparedStatementHandler_query.png" alt="PreparedStatementHandler_query"></p> <h4 id="返回数据解析"><a href="#返回数据解析" class="header-anchor">#</a> 返回数据解析</h4> <p>将 JDBC 返回类型转换为 Java 类型, 根据 resultSets 和 resultMap 进行转换</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/handleResultSets.png" alt="handleResultSets"></p> <h3 id="_5-4-mybatis-中分页如何实现"><a href="#_5-4-mybatis-中分页如何实现" class="header-anchor">#</a> 5.4 Mybatis 中分页如何实现</h3> <p>通过 Mybatis 执行分页 SQL 有两种实现方式, 一种是编写 SQL 时添加 LIMIT, 一种是全局处理</p> <h4 id="sql-分页"><a href="#sql-分页" class="header-anchor">#</a> SQL 分页</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token operator">&lt;</span><span class="token keyword">select</span> id<span class="token operator">=</span><span class="token string">&quot;getSubjectByPage&quot;</span> resultMap<span class="token operator">=</span><span class="token string">&quot;resultAutoMap&quot;</span><span class="token operator">&gt;</span>
    <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> SUBJECT <span class="token keyword">LIMIT</span> <span class="token comment">#{CURRINDEX} , #{PAGESIZE}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">select</span><span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="拦截器分页"><a href="#拦截器分页" class="header-anchor">#</a> 拦截器分页</h4> <p>上文说到, Mybatis 支持了插件扩展机制, 可以拦截到具体对象的方法以及对应入参级别</p> <p>我们添加插件时需要实现 <strong>Interceptor</strong> 接口, 然后将插件写在 mybatis-config.xml 配置文件中或者添加相关注解, Mybatis 初始化时解析才能在项目启动时添加到插件容器中</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/pluginElement.png" alt="pluginElement"></p> <p>由一个 List 结构存储项目中全部拦截器, 通过 <strong>Configuration#addInterceptor</strong> 方法添加</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/InterceptorChain.png" alt="InterceptorChain"></p> <p>重点需要关注 <strong>Interceptor#pluginAll</strong> 中 plugin 方法, Interceptor 只是一个接口, plugin 方法只能由其实现类完成</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/ExamplePlugin.png" alt="ExamplePlugin"></p> <p>Plugin 可以理解为是一个工具类, <strong>Plugin#wrap</strong> 返回的是一个动态代理类 </p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/wrap.png" alt="wrap"></p> <p>这里使用一个测试的 Demo 看一下方法运行时的参数</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/AlwaysMapPlugin.png" alt="AlwaysMapPlugin"></p> <p>虽然是随便写的 Demo, 但是与正式使用的插件并无实际区别</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/image-20200902103355292.png" alt="插件运行状态"></p> <h2 id="_6、相关链接"><a href="#_6、相关链接" class="header-anchor">#</a> 6、相关链接</h2> <p><a href="https://github.com/Mybatis/Mybatis-3" title="源码下载地址" target="_blank" rel="noopener noreferrer">源码下载地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://carbon.now.sh/" target="_blank" rel="noopener noreferrer">代码生成图片<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.mdnice.com/" target="_blank" rel="noopener noreferrer">多功能在线Markdown编辑器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1b4c17a3.js" defer></script><script src="/assets/js/2.ad010850.js" defer></script><script src="/assets/js/31.321ab434.js" defer></script>
  </body>
</html>
