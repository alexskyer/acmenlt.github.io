<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前言 | 龙台技术笔记</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/images/book.png">
    <link rel="manifest" href="/images/book.png">
    <link rel="apple-touch-icon" href="/images/book.png">
    <meta name="description" content="技术人写的技术笔记（工作总结）">
    <meta http-quiv="pragma" cotent="no-cache">
    <meta http-quiv="pragma" cotent="no-cache,must-revalidate">
    <meta http-quiv="expires" cotent="0">
    
    <link rel="preload" href="/assets/css/0.styles.56f8f03c.css" as="style"><link rel="preload" href="/assets/js/app.9f6db045.js" as="script"><link rel="preload" href="/assets/js/2.ad010850.js" as="script"><link rel="preload" href="/assets/js/26.ee0820ec.js" as="script"><link rel="prefetch" href="/assets/js/10.cbffc92a.js"><link rel="prefetch" href="/assets/js/11.05ca654e.js"><link rel="prefetch" href="/assets/js/12.ad56d1ad.js"><link rel="prefetch" href="/assets/js/13.cbb68b5f.js"><link rel="prefetch" href="/assets/js/14.deb3efeb.js"><link rel="prefetch" href="/assets/js/15.4bd8d806.js"><link rel="prefetch" href="/assets/js/16.18544ac8.js"><link rel="prefetch" href="/assets/js/17.3d970734.js"><link rel="prefetch" href="/assets/js/18.24bdf351.js"><link rel="prefetch" href="/assets/js/19.20ee8468.js"><link rel="prefetch" href="/assets/js/20.76cc2f2f.js"><link rel="prefetch" href="/assets/js/21.a060d59a.js"><link rel="prefetch" href="/assets/js/22.8dd2c3cb.js"><link rel="prefetch" href="/assets/js/23.38503d1a.js"><link rel="prefetch" href="/assets/js/24.b5bab63e.js"><link rel="prefetch" href="/assets/js/25.f541c5de.js"><link rel="prefetch" href="/assets/js/27.8e2f5fd3.js"><link rel="prefetch" href="/assets/js/28.b05c6b48.js"><link rel="prefetch" href="/assets/js/29.19cdc57c.js"><link rel="prefetch" href="/assets/js/3.d533eea8.js"><link rel="prefetch" href="/assets/js/30.98878ec6.js"><link rel="prefetch" href="/assets/js/31.572b5ab4.js"><link rel="prefetch" href="/assets/js/32.bce65027.js"><link rel="prefetch" href="/assets/js/33.37e89393.js"><link rel="prefetch" href="/assets/js/34.ba1a6fba.js"><link rel="prefetch" href="/assets/js/35.c7dd14b8.js"><link rel="prefetch" href="/assets/js/36.91b56d4a.js"><link rel="prefetch" href="/assets/js/37.818f9351.js"><link rel="prefetch" href="/assets/js/38.f7f3e6b0.js"><link rel="prefetch" href="/assets/js/39.4a1489dc.js"><link rel="prefetch" href="/assets/js/4.d52d5841.js"><link rel="prefetch" href="/assets/js/40.175dfc07.js"><link rel="prefetch" href="/assets/js/41.d75e30b9.js"><link rel="prefetch" href="/assets/js/42.dcfe80e6.js"><link rel="prefetch" href="/assets/js/43.4669e03d.js"><link rel="prefetch" href="/assets/js/44.5b6aa46b.js"><link rel="prefetch" href="/assets/js/5.8c9ed1e9.js"><link rel="prefetch" href="/assets/js/6.256d2fbb.js"><link rel="prefetch" href="/assets/js/7.26cc56f0.js"><link rel="prefetch" href="/assets/js/8.d0a0d91a.js"><link rel="prefetch" href="/assets/js/9.272d66c4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.56f8f03c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">龙台技术笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/db/" class="nav-link">
  数据库
</a></div><div class="nav-item"><a href="/thread/" class="nav-link">
  并发编程
</a></div><div class="nav-item"><a href="/frame/" class="nav-link router-link-active">
  框架知识
</a></div><div class="nav-item"><a href="/design/" class="nav-link">
  代码设计
</a></div><div class="nav-item"><a href="/bug/" class="nav-link">
  BUG 专栏
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其它" class="dropdown-title"><span class="title">其它</span> <span class="arrow down"></span></button> <button type="button" aria-label="其它" class="mobile-dropdown-title"><span class="title">其它</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/acmenlt" target="_blank" rel="noopener noreferrer" class="nav-link external">
  动态线程池
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/acmenlt/House-Notes" target="_blank" rel="noopener noreferrer" class="nav-link external">
  买房实践
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/acmenlt" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/db/" class="nav-link">
  数据库
</a></div><div class="nav-item"><a href="/thread/" class="nav-link">
  并发编程
</a></div><div class="nav-item"><a href="/frame/" class="nav-link router-link-active">
  框架知识
</a></div><div class="nav-item"><a href="/design/" class="nav-link">
  代码设计
</a></div><div class="nav-item"><a href="/bug/" class="nav-link">
  BUG 专栏
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其它" class="dropdown-title"><span class="title">其它</span> <span class="arrow down"></span></button> <button type="button" aria-label="其它" class="mobile-dropdown-title"><span class="title">其它</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/acmenlt" target="_blank" rel="noopener noreferrer" class="nav-link external">
  动态线程池
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/acmenlt/House-Notes" target="_blank" rel="noopener noreferrer" class="nav-link external">
  买房实践
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/acmenlt" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前言</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frame/%E7%AE%80%E5%8D%954%E6%AD%A5%E5%AE%9A%E4%B9%89%E5%85%AC%E5%85%B1SpringBoot-Starter.html#前言" class="sidebar-link">前言</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/frame/%E7%AE%80%E5%8D%954%E6%AD%A5%E5%AE%9A%E4%B9%89%E5%85%AC%E5%85%B1SpringBoot-Starter.html#starter" class="sidebar-link">starter</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frame/%E7%AE%80%E5%8D%954%E6%AD%A5%E5%AE%9A%E4%B9%89%E5%85%AC%E5%85%B1SpringBoot-Starter.html#starter-定义" class="sidebar-link">starter 定义</a></li><li class="sidebar-sub-header"><a href="/frame/%E7%AE%80%E5%8D%954%E6%AD%A5%E5%AE%9A%E4%B9%89%E5%85%AC%E5%85%B1SpringBoot-Starter.html#starter-好处" class="sidebar-link">starter 好处</a></li></ul></li><li><a href="/frame/%E7%AE%80%E5%8D%954%E6%AD%A5%E5%AE%9A%E4%B9%89%E5%85%AC%E5%85%B1SpringBoot-Starter.html#自定义-starter" class="sidebar-link">自定义 starter</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frame/%E7%AE%80%E5%8D%954%E6%AD%A5%E5%AE%9A%E4%B9%89%E5%85%AC%E5%85%B1SpringBoot-Starter.html#starter-命名" class="sidebar-link">starter 命名</a></li><li class="sidebar-sub-header"><a href="/frame/%E7%AE%80%E5%8D%954%E6%AD%A5%E5%AE%9A%E4%B9%89%E5%85%AC%E5%85%B1SpringBoot-Starter.html#创建-springboot-项目" class="sidebar-link">创建 springboot 项目</a></li><li class="sidebar-sub-header"><a href="/frame/%E7%AE%80%E5%8D%954%E6%AD%A5%E5%AE%9A%E4%B9%89%E5%85%AC%E5%85%B1SpringBoot-Starter.html#pom-依赖配置" class="sidebar-link">pom 依赖配置</a></li><li class="sidebar-sub-header"><a href="/frame/%E7%AE%80%E5%8D%954%E6%AD%A5%E5%AE%9A%E4%B9%89%E5%85%AC%E5%85%B1SpringBoot-Starter.html#自动配置类" class="sidebar-link">自动配置类</a></li><li class="sidebar-sub-header"><a href="/frame/%E7%AE%80%E5%8D%954%E6%AD%A5%E5%AE%9A%E4%B9%89%E5%85%AC%E5%85%B1SpringBoot-Starter.html#spring-factories" class="sidebar-link">spring.factories</a></li><li class="sidebar-sub-header"><a href="/frame/%E7%AE%80%E5%8D%954%E6%AD%A5%E5%AE%9A%E4%B9%89%E5%85%AC%E5%85%B1SpringBoot-Starter.html#打包仓库" class="sidebar-link">打包仓库</a></li><li class="sidebar-sub-header"><a href="/frame/%E7%AE%80%E5%8D%954%E6%AD%A5%E5%AE%9A%E4%B9%89%E5%85%AC%E5%85%B1SpringBoot-Starter.html#测试-starter" class="sidebar-link">测试 starter</a></li></ul></li><li><a href="/frame/%E7%AE%80%E5%8D%954%E6%AD%A5%E5%AE%9A%E4%B9%89%E5%85%AC%E5%85%B1SpringBoot-Starter.html#可插拔-starter" class="sidebar-link">可插拔 starter</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frame/%E7%AE%80%E5%8D%954%E6%AD%A5%E5%AE%9A%E4%B9%89%E5%85%AC%E5%85%B1SpringBoot-Starter.html#自定义可插拔-starter" class="sidebar-link">自定义可插拔 starter</a></li><li class="sidebar-sub-header"><a href="/frame/%E7%AE%80%E5%8D%954%E6%AD%A5%E5%AE%9A%E4%B9%89%E5%85%AC%E5%85%B1SpringBoot-Starter.html#zuul-实现可插拔原理" class="sidebar-link">zuul 实现可插拔原理</a></li></ul></li><li><a href="/frame/%E7%AE%80%E5%8D%954%E6%AD%A5%E5%AE%9A%E4%B9%89%E5%85%AC%E5%85%B1SpringBoot-Starter.html#配置元数据" class="sidebar-link">配置元数据</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/frame/%E7%AE%80%E5%8D%954%E6%AD%A5%E5%AE%9A%E4%B9%89%E5%85%AC%E5%85%B1SpringBoot-Starter.html#mybatis-starter-如何实现" class="sidebar-link">mybatis starter 如何实现</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>最近在整理公司公共 starter 内容，也是想写一篇关于 starter 文章，让更多不了解的小伙伴掌握这项核心技能</p> <p>文章从零到一的封装设计 starter，并提供可插拔 starter 以及元数据配置等说明，并在可插拔上与开源 zuul 进行比对，希望小伙伴看后有所收获</p> <blockquote><p><strong>文章大纲如下：</strong></p> <ul><li>starter
<ul><li>starter 定义</li> <li>starter 好处</li></ul></li> <li>自定义 starter
<ul><li>starter 命名</li> <li>创建 springboot 项目</li> <li>pom 依赖配置</li> <li>自动配置类</li> <li>spring.factories</li> <li>打包仓库</li> <li>测试 starter</li></ul></li> <li>可插拔 starter
<ul><li>自定义可插拔 starter</li> <li>zuul 实现可插拔原理</li></ul></li> <li>配置元数据</li> <li>结言</li></ul></blockquote> <h2 id="starter"><a href="#starter" class="header-anchor">#</a> starter</h2> <h3 id="starter-定义"><a href="#starter-定义" class="header-anchor">#</a> starter 定义</h3> <p>springboot starter 类似于一种插件机制，抛弃了之前繁琐的配置，将复杂依赖统一集成进 starter</p> <p>所有依赖模块都遵循着约定成俗的默认配置，并允许我们调整这些配置，即遵循“约定大于配置”的理念</p> <h3 id="starter-好处"><a href="#starter-好处" class="header-anchor">#</a> starter 好处</h3> <p>starter 的出现极大的帮助开发者们从繁琐的框架配置中解放出来，从而更专注于业务代码</p> <p>并且 springboot 官方提供除了企业级项目不同场景的 starter 依赖模块，可以很便捷的集成进项目</p> <p>比如 springboot 项目需要依赖 redis，我们只需要加入 spring-boot-starter-data-redis 依赖，并配置一些必须的连接信息</p> <p>使用者只需要引用 starter 依赖，springboot 就可以自动加载项目所需要的配置依赖，彻底摆脱了不同的依赖库引用以及版本问题</p> <h2 id="自定义-starter"><a href="#自定义-starter" class="header-anchor">#</a> 自定义 starter</h2> <h3 id="starter-命名"><a href="#starter-命名" class="header-anchor">#</a> starter 命名</h3> <p>官方对 starter 包定义的 artifactId 是有要求的，当然也可以不遵守（毕竟你的项目你做主）</p> <p>spring 官方提供 starter 通常命名为 spring-boot-starter-{name} 如：</p> <p>spring-boot-starter-web，spring-boot-starter-activemq 等，这里放一部分官方提供列表，详情查看 springboot starter 列表</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/image-20201129194809416.png" alt=""></p> <p>spring 官方建议非官方提供的 starter 命名应遵守 {name}-spring-boot-starter 的格式</p> <p>比如 mybatis 出品的：mybatis-spring-boot-starter</p> <h3 id="创建-springboot-项目"><a href="#创建-springboot-项目" class="header-anchor">#</a> 创建 springboot 项目</h3> <p>starter 也是基于 springboot 项目创建的，所以第一步应该先创建 springboot 项目</p> <p>创建工程完成后，删除不必要文件，目录如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>├── pom<span class="token punctuation">.</span>xml
└── src
    ├── main
    │   ├── java
    │   │   └── cn
    │   │       └── machen
    │   │           └── starter
    │   │               └── demospringbootstarter
    │   └── resources
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="pom-依赖配置"><a href="#pom-依赖配置" class="header-anchor">#</a> pom 依赖配置</h3> <p>pom.xml 中依赖非常简洁，除了项目的基本信息和父类引用，只需引用 spring-boot-starter 即可</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2.11.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>relativePath</span><span class="token punctuation">/&gt;</span></span> <span class="token comment">&lt;!-- lookup parent from repository --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.machen.starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>demo-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.0.1-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h3 id="自动配置类"><a href="#自动配置类" class="header-anchor">#</a> 自动配置类</h3> <p>创建一个注册为 spring bean 的 service 类，提供一个 sayHello 方法以供后续测试</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServiceBean</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World, %s&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>创建自动配置类，将 ServiceBean 进行声明 Bean，等待扫描后交付给 spring ioc 容器</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AutoConfigurationTest</span> <span class="token punctuation">{</span>
    
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ServiceBean</span> <span class="token function">getServiceBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ServiceBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="spring-factories"><a href="#spring-factories" class="header-anchor">#</a> spring.factories</h3> <p>项目 resources 目录下新建 META-INF 文件夹，然后创建 spring.factories 文件</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/image-20201129205823758.png" alt=""></p> <p>文件中定义 autoconfigure 指定配置类为自动装配的配置</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
  cn.machen.starter.demospringbootstarter.AutoConfigurationTest
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>为什么要指定 resources/META-INF 下写 spring.factories？不这么写不行啊</strong></p> <p>SpringFactoriesLoader#loadFactories 负责完成自动装配类的加载，扫描的就是这个变量文件</p> <p>你不按照规定写可以，扫不到你的自动配置类可咋整，消停的吧</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/image-20201129211743527.png" alt=""></p> <h3 id="打包仓库"><a href="#打包仓库" class="header-anchor">#</a> 打包仓库</h3> <p>我们提供 starter 肯定是要被第三方或者我们其它项目所引用的，所以要把项目打包后发布到仓库中</p> <p>这里科普一下 maven 命令知识点，一般我们打包使用比较多的命令就是 package、install、deploy</p> <p>声明一点就是这三个命令都能打包，有什么区别呢？</p> <p><strong>package：</strong></p> <p>该命令完成了项目编译、单元测试、打包功能三个过程</p> <p><strong>install：</strong></p> <p>在 package 命令的前提下新增一个步骤，将新打好的包部署到本地 maven 仓库</p> <p><strong>deploy：</strong></p> <p>在 install 命令的前提下新增一个步骤，将新打的包部署到远端仓库（相当于本地和远端仓库同时部署一份）</p> <p>而我们只是本地仓库引用，只需要 install 命令执行即可，两种方式分别是 maven 插件或者终端执行命令 <strong>mvn clean install</strong></p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/image-20201130144733124.png" alt=""></p> <p>可以去对应的仓库坐标下查看 jar 是否部署成功</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/image-20201130145828049.png" alt=""></p> <h3 id="测试-starter"><a href="#测试-starter" class="header-anchor">#</a> 测试 starter</h3> <p>我们如何测试刚才新建的 starter 是否成功了呢？新建一个项目引用 starter 项目坐标就可以啦</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">&quot;1.0&quot;</span> encoding<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>project xmlns<span class="token operator">=</span><span class="token string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> xmlns<span class="token operator">:</span>xsi<span class="token operator">=</span><span class="token string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
         xsi<span class="token operator">:</span>schemaLocation<span class="token operator">=</span><span class="token string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span><span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>modelVersion<span class="token punctuation">&gt;</span></span><span class="token number">4.0</span><span class="token number">.0</span><span class="token operator">&lt;</span><span class="token operator">/</span>modelVersion<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>parent<span class="token punctuation">&gt;</span></span>
        <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>starter<span class="token operator">-</span>parent<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">2.2</span><span class="token number">.11</span><span class="token punctuation">.</span>RELEASE<span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>relativePath<span class="token operator">/</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> lookup parent from repository <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>parent<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>cn<span class="token punctuation">.</span>machen<span class="token punctuation">.</span>starter<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>demo<span class="token operator">-</span>test<span class="token operator">-</span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>starter<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">0.0</span><span class="token number">.1</span><span class="token operator">-</span>SNAPSHOT<span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>

    <span class="token generics"><span class="token punctuation">&lt;</span>dependencies<span class="token punctuation">&gt;</span></span>
        <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
            <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>starter<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 引入 starter 包 <span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
            <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>cn<span class="token punctuation">.</span>machen<span class="token punctuation">.</span>starter<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>demo<span class="token operator">-</span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>starter<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span>$<span class="token punctuation">{</span>project<span class="token punctuation">.</span>version<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>

        <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
            <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>starter<span class="token operator">-</span>test<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>scope<span class="token punctuation">&gt;</span></span>test<span class="token operator">&lt;</span><span class="token operator">/</span>scope<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>exclusions<span class="token punctuation">&gt;</span></span>
                <span class="token generics"><span class="token punctuation">&lt;</span>exclusion<span class="token punctuation">&gt;</span></span>
                    <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>vintage<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
                    <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>junit<span class="token operator">-</span>vintage<span class="token operator">-</span>engine<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>exclusion<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>exclusions<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>dependencies<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>project<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p>既然是测试，<strong>达到什么样的标准才算通过呢？</strong></p> <p>根据我们 starter 中定义代码，只要 demo-test 项目 <strong>引用 ServiceBean 打印输出对应信息</strong> 即算成功</p> <p>src-main-test 目录下使用项目创建自带的测试类</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">DemoTestSpringBootStarterApplicationTests</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ServiceBean</span> serviceBean<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">contextLoads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>serviceBean<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token string">&quot;machen&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>运行 contextLoads 测试方法，最终输出 <strong>Hello World, machen</strong></p> <p>你以为这就结束了么？不不不，硬核且干的知识才刚刚开始</p> <h2 id="可插拔-starter"><a href="#可插拔-starter" class="header-anchor">#</a> 可插拔 starter</h2> <h3 id="自定义可插拔-starter"><a href="#自定义可插拔-starter" class="header-anchor">#</a> 自定义可插拔 starter</h3> <p>starter 就是 starter，咋起了个名字叫 <strong>可插拔</strong></p> <p>所谓可插拔，字面意思理解就是虽然我引入了你的 starter jar 包，但是可以通过条件判断是否加载你的功能</p> <p>满足条件的话加载此 jar 相关配置，不满足就哪凉快哪歇着吧（比较白话哈，具体点就是模块插件化，降低耦合）</p> <p>实现可插拔的方式有很多，通过配置文件 key 前缀或者自定义注解等，但是这些都绕不过 springboot 的条件注解</p> <p>文章使用自定义注解 + 条件注解的形式完成，其余这里就不一一举例了，大家可以网上自行搜索</p> <p><strong>demo-spring-boot-starter</strong></p> <p>1）首先在项目中创建自定义注解</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">EnableAutoConfigTest</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>2）AutoConfigurationTest 类中添加条件注解，然后重新打包至本地仓库</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@ConditionalOnBean</span><span class="token punctuation">(</span>annotation <span class="token operator">=</span> <span class="token class-name">EnableAutoConfigTest</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AutoConfigurationTest</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">ServiceBean</span> <span class="token function">getServiceBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ServiceBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>demo-test-spring-boot-starter</strong></p> <p>1）在主程序引用 @EnableAutoConfigTest 注解</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@EnableAutoConfigTest</span><span class="token annotation punctuation">@SpringBootApplicationpublic</span> <span class="token keyword">class</span> <span class="token class-name">DemoTestSpringBootStarterApplication</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">DemoTestSpringBootStarterApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>测试可插拔 starter</strong></p> <p>跑一下上文测试类中运行程序，这样的常规操作自然可以正常打印我们的 Hello World</p> <p>跑程序谁家只跑正常的呀是不是，把 @EnableAutoConfigTest 删了试一哈，看迎接咱的是不是这玩意</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Unsatisfied</span> dependency expressed through field <span class="token string">'serviceBean'</span><span class="token punctuation">;</span> nested exception is <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span></span>NoSuchBeanDefinitionException</span><span class="token operator">:</span> <span class="token class-name">No</span> qualifying bean of type <span class="token string">'cn.machen.starter.demospringbootstarter.ServiceBean'</span> available<span class="token operator">:</span> expected at least <span class="token number">1</span> bean which qualifies as autowire <span class="token class-name"><span class="token namespace">candidate<span class="token punctuation">.</span></span> Dependency</span> annotations<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token annotation punctuation">@org.springframework.beans.factory.annotation.Autowired</span><span class="token punctuation">(</span>required<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>当然，正式环境上可不能实现的这么糙哈，不过，思路都是一致的</p> <p>之前参与公司搜索业务封装 starter，就是采用上述自定义注解结合条件注解完成的</p> <p>其实除了文中可插拔的实现之外，像 springcloud zuul 也是类似的思路，因为就这点玩意，也玩不出个花</p> <h3 id="zuul-实现可插拔原理"><a href="#zuul-实现可插拔原理" class="header-anchor">#</a> zuul 实现可插拔原理</h3> <p>我们通常是通过配置类上配置 zuul 注解 @EnableZuulProxy 开启 Zuul 注入功能</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/image-20201206235008816.png" alt=""></p> <p>关于 @Import 注解在之前的文章 <strong># <a href="https://mp.weixin.qq.com/s/HR1MVU0DdvZ0GjndZrwpKA" target="_blank" rel="noopener noreferrer">深入理解 Spring @Import 不同方式注册 Bean<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong> 已经详细讲过了</p> <p>看一下图片中标红的类起到了什么作用</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/image-20201206235256360.png" alt=""></p> <p>通过类上的注释得知：</p> <blockquote><p>负责添加标记 bean 以触发 {@link ZuulProxyAutoConfiguration} 的激活</p></blockquote> <p>其实到这里就已经很明白了，但是本着负责到底的良好品质，继续跟进</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/image-20201206235503751.png" alt=""></p> <p>和我们上面自定义可插拔 starter 思想一致，通过一个标记来实现可插拔特性</p> <p>不同的是 zuul 中使用过一个无实际意义的 bean 来标记，而我们使用的注解</p> <h2 id="配置元数据"><a href="#配置元数据" class="header-anchor">#</a> 配置元数据</h2> <p>不知道小伙伴在项目配置文件中输入时，看到智能提示时，有没有疑惑怎么实现的？</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/image-20201206161835727.png" alt=""></p> <p>以server.xxx为例，带着疑惑打开 springboot 源码包下的 spring-configuration-metadata.json</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/image-20201206161928363.png" alt=""></p> <p>看到 defaultValue 和 description 熟悉么？可不就是上文中提示的默认值以及提示信息嘛</p> <p>这种文件如何产生的呢？有两种方式</p> <ol><li>通过建立 META-INF/spring-configuration-metadata.json 文件，开发者手动配置</li> <li>还有一种是通过注解 @ConfigurationProperties 方式自动生成</li></ol> <p>有自动生成的肯定优先使用呀，毕竟我这么懒的人。实现元数据配置只需要在 starter 包下简单三步操作</p> <p>1）提供引用 pom.xml 中加入 spring-boot-configuration-processor 包</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-configuration-processor<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>2）编写 Properties 配置类，以 swagger 示例</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;swagger&quot;</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SwaggerProperties</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * 文档扫描包路径     */</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> basePackage <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>    <span class="token comment">/**     * title 示例: 订单创建接口     */</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> title <span class="token operator">=</span> <span class="token string">&quot;平台系统接口详情&quot;</span><span class="token punctuation">;</span>    <span class="token comment">/**     * 服务条款网址     */</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> termsOfServiceUrl <span class="token operator">=</span> <span class="token string">&quot;https://www.xxxx.com/&quot;</span><span class="token punctuation">;</span>    <span class="token comment">/**     * 版本号     */</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> version <span class="token operator">=</span> <span class="token string">&quot;V_1.0.0&quot;</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>3）最后执行打包命令，更新本地仓库 jar 包</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mvn clean <span class="token function">install</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>接下来在 demo-test-spring-boot-starter 项目更新引用，然后在 application.properties 测试一下</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/image-20201206234438407.png" alt=""></p> <p>此等装x利器，一定要和亲朋好友多多普及 [狗头]</p> <h2 id="mybatis-starter-如何实现"><a href="#mybatis-starter-如何实现" class="header-anchor">#</a> mybatis starter 如何实现</h2> <p>我们引一下相关 pom 包依赖，如果大家平常找不到相关依赖包，可以在公共仓库上搜索</p> <blockquote><p>公共仓库地址：https://mvnrepository.com/</p></blockquote> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis.spring.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.3.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>看一下 mybatis starter 包里都包含什么内容，是否和我们自定义一致</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/image-20201207003918726.png" alt=""></p> <p>why？这里面为啥该有的配置类元信息啥的都没有？点进去可能找到答案的 pom.xml 看一哈</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/image-20201207004100494.png" alt=""></p> <p>可以看到 pom.xml 中包含 mybatis-spring-boot-autoconfigure、mybatis、mybatis-spring 依赖</p> <p>而真正让 mybatis 进行全局初始化的秘密就在 mybatis-spring-boot-autoconfigure 中</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/image-20201207004550609.png" alt=""></p> <p>到这里就很明确了，mybatis-spring-boot-autoconfigure 包含初始化配置类 MybatisAutoConfiguration，在其中做了 mybatis 相关初始化</p> <p><strong>mybatis starter 设计与我们上文讲的自定义 starter 有何不同？</strong></p> <p>mybatis starter 并没有做什么操作，只是做了一个组合依赖作用，起到初始化作用的是其中 autoconfigure 包</p> <blockquote><p>springboot 也是这种思想，只不过它是将所有包的 autoconfigure 实现统一发现的，大家看一下 spring-boot-autoconfigure-xxx.jar 就会明白</p></blockquote> <p>而我们自定义 starter 中就少了依赖 autoconfigure 包这个环节，两者无关对错，只是不同设计的体现，这里不作任何建议，看个人喜好</p> <p>啥？你说要跟着主流走，严格贯彻 springboot 思想？</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/u=1298196854,4096730639&amp;fm=26&amp;gp=0.jpg" alt=""></p> <p>就料到你会这么想，所以我们也搬来了“重量级”选手 netflix</p> <p><img src="https://images-machen.oss-cn-beijing.aliyuncs.com/image-20201207005851728.png" alt=""></p> <p>懂的人自然懂，看心情实现 starter 吧，一天到晚写 BUG 的互联网人～</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.9f6db045.js" defer></script><script src="/assets/js/2.ad010850.js" defer></script><script src="/assets/js/26.ee0820ec.js" defer></script>
  </body>
</html>
